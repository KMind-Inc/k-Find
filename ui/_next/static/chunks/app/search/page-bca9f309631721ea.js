(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{7602:function(e,t,n){Promise.resolve().then(n.bind(n,3774))},4981:function(e,t,n){"use strict";n.d(t,{o:function(){return d}});var s=n(7437),a=n(2553),r=n(2265),l=n(2290),i=n(8787),o=n(6463),c=n(3375);let d=e=>{let{useContinueButton:t=!1}=e,[n,d]=(0,r.useState)("");(0,o.useRouter)(),decodeURIComponent((0,o.useSearchParams)().get("rid")||"");let[u,m]=(0,r.useState)(()=>"true"===localStorage.getItem("isNormalSearch"));(0,r.useEffect)(()=>{localStorage.setItem("isNormalSearch",String(u))},[u]);let h=e=>{if(e.preventDefault(),n){d("");let e=(0,l.x0)();window.location.href=(0,a.T)(encodeURIComponent(n),e,u?"SIMPLE":"DEEP")}};return(0,s.jsx)("form",{onSubmit:h,children:(0,s.jsxs)("label",{className:"border-2 border-blue-500 relative bg-white flex flex-col justify-end border ring-8 ring-zinc-300/20 py-2 px-2 rounded-lg gap-2 focus-within:border-zinc-300",htmlFor:"search-bar",children:[(0,s.jsx)("textarea",{id:"search-bar",value:n,onChange:e=>d(e.target.value),autoFocus:!0,placeholder:c.ZP.Search.placeholder,className:"rounded-md px-2 w-full outline-none flex-1 pr-6 bg-white h-32 resize-none",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||h(e)}}),(0,s.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,s.jsx)(i.Z,{checked:!u,onChange:()=>m(!u),checkedChildren:c.ZP.Type.deep,unCheckedChildren:c.ZP.Type.simple,defaultChecked:!1})})]})})}},3375:function(e,t,n){"use strict";n.d(t,{nW:function(){return r},DC:function(){return a},t4:function(){return c},ZP:function(){return i},VQ:function(){return o}});let s={en:{Type:{simple:"SIMPLE",deep:"DEEP"},Title:{return:"Return"},Search:{placeholder:"Based on kOS Intelligent Search..."},Footer:{statement:"The above content is searched and summarized by kFind AI, please carefully check."},Answer:{answer:"Answer"},Sources:{sources:"Answers from the Internet"},Err:{429:"Thanks for the many questions kFind needs to answer, but too often, let me take a break.",500:"Hello, kFind is in a bit of a mess, let him rest for a while, thank you!"}},cn:{Type:{simple:"普通",deep:"深度"},Title:{return:"返回"},Search:{placeholder:"基于kOS智能搜索..."},Footer:{statement:"上述内容由kFind AI搜索并总结，请仔细甄别。"},Answer:{answer:"回答"},Sources:{sources:"答案来自网页"},Err:{429:"感谢有很多问题需要kFind解答，但过于频繁，容我休息一下",500:"您好，kFind这会有点手忙脚乱，容他休息一会，谢谢！"}}},a=Object.keys(s),r={en:"English",cn:"简体中文"},l="lang";var i=s[o()];function o(){let e=function(e){try{return localStorage.getItem(e)}catch(e){return null}}(l);if(a.includes(null!=e?e:""))return e;let t=function(){try{return navigator.language.toLowerCase()}catch(e){return"en"}}();for(let e of a)if(t.includes(e))return e;return"en"}function c(e){!function(e,t){try{localStorage.setItem(e,t)}catch(e){}}(l,e),location.reload()}},3774:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var s=n(7437),a=n(2265),r=n(8236),l=n(4839),i=n(6164);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.m6)((0,l.W)(t))}let c=r.fC,d=r.xz,u=a.forwardRef((e,t)=>{let{className:n,align:a="center",sideOffset:l=4,...i}=e;return(0,s.jsx)(r.h_,{children:(0,s.jsx)(r.VY,{ref:t,align:a,sideOffset:l,className:o("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...i})})});function m(e){let{className:t,...n}=e;return(0,s.jsx)("div",{className:o("animate-pulse rounded-md bg-muted",t),...n})}u.displayName=r.VY.displayName;let h=e=>{let{title:t,content:n}=e;return(0,s.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,s.jsx)("div",{className:"flex gap-2 text-blue-500",children:t}),n]})};var x=n(6648),f=n(8904),p=n(3375);let g=e=>{let{markdown:t,sources:n}=e;return(0,s.jsx)(h,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.default,{src:"/answer.svg",alt:"Answer",width:24,height:24})," "," ",p.ZP.Answer.answer]}),content:t?(0,s.jsx)("div",{className:"prose prose-sm max-w-full",children:(0,s.jsx)(f.U,{components:{a:e=>{let{node:t,...a}=e;if(!a.href)return(0,s.jsx)(s.Fragment,{});let r=n[+a.href-1];return r?(0,s.jsx)("span",{className:"inline-block w-4",children:(0,s.jsxs)(c,{children:[(0,s.jsx)(d,{asChild:!0,children:(0,s.jsx)("span",{title:r.name,className:"inline-block cursor-pointer transform scale-[60%] no-underline font-medium bg-zinc-300 hover:bg-zinc-400 w-6 text-center h-6 rounded-full origin-top-left",children:a.href})}),(0,s.jsxs)(u,{align:"start",className:"max-w-screen-md flex flex-col gap-2 bg-white shadow-transparent ring-zinc-50 ring-4 text-xs",children:[(0,s.jsx)("div",{className:"text-ellipsis overflow-hidden whitespace-nowrap font-medium",children:r.name}),(0,s.jsx)("div",{className:"flex gap-2 items-center",children:(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,s.jsx)("div",{className:"text-ellipsis text-blue-500 overflow-hidden whitespace-nowrap",children:(0,s.jsx)("a",{title:r.name,href:r.url,target:"_blank",children:r.url})})})})]})]})}):(0,s.jsx)(s.Fragment,{})}},children:t})}):(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(m,{className:"max-w-sm h-4 bg-zinc-200"}),(0,s.jsx)(m,{className:"max-w-lg h-4 bg-zinc-200"}),(0,s.jsx)(m,{className:"max-w-2xl h-4 bg-zinc-200"}),(0,s.jsx)(m,{className:"max-w-lg h-4 bg-zinc-200"}),(0,s.jsx)(m,{className:"max-w-xl h-4 bg-zinc-200"})]})})},w=e=>{let{source:t,index:n}=e,{name:a,url:r}=t;return new URL(r).hostname,(0,s.jsxs)("div",{className:"relative flex items-center gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center text-gray-500 justify-center h-4 w-4  text-sm",children:[n+1,"."]}),(0,s.jsx)("div",{className:"overflow-hidden text-gray-500 whitespace-nowrap text-sm",children:a}),(0,s.jsx)("a",{href:r,target:"_blank",className:"absolute inset-0"}),(0,s.jsx)("img",{src:"link.svg",alt:"Link",width:12,height:12})]})},b=e=>{let{sources:t}=e;return(0,s.jsx)(h,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:"link.svg",alt:"Link",width:24,height:24})," "," ",p.ZP.Sources.sources]}),content:(0,s.jsx)("div",{className:"grid gap-2",children:t.length>0?t.map((e,t)=>(0,s.jsx)(w,{index:t,source:e},e.id)):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m,{className:"max-w-sm h-4 bg-zinc-200/80"}),(0,s.jsx)(m,{className:"max-w-lg h-4 bg-zinc-200/80"}),(0,s.jsx)(m,{className:"max-w-2xl h-4 bg-zinc-200/80"}),(0,s.jsx)(m,{className:"max-w-lg h-4 bg-zinc-200/80"}),(0,s.jsx)(m,{className:"max-w-xl h-4 bg-zinc-200/80"}),(0,s.jsx)(m,{className:"max-w-2sm h-4 bg-zinc-200/80"})]})})})};async function j(e,t,n,s){let{done:a,value:r}=await e.read();if(a){s&&s(),t.close();return}return n&&n(r),t.enqueue(r),j(e,t,n,s)}let v=(e,t,n)=>{let s=e.body.getReader();return new ReadableStream({start:e=>j(s,e,t,n)})},N="__LLM_RESPONSE__",y="__RELATED_QUESTIONS__",S=async(e,t,n,s)=>{console.log("parse-streaming fetchJobId: ",e,t,n,s);let a=await fetch("/start",{method:"POST",headers:{"Content-Type":"application/json",Accept:"*./*"},body:JSON.stringify({query:e,search_uuid:t,search_type:n,lang:s})});return 200!==a.status?null:(await a.json()).jobId},k=async(e,t,n,s,a,r,l,i,o,c,d)=>{var u;let m,h;console.log("parseStreaming: ",n,s,a);let x=new TextDecoder,f=new Uint8Array,p="",g=!1,w=await fetch("/answer",{method:"POST",headers:{"Content-Type":"application/json",Accept:"*./*"},body:JSON.stringify({query:t,search_uuid:n,search_type:s,lang:r,job_id:a})});if(200!==w.status)return null;let b=await w.clone(),j=await b.clone(),S=w.headers.get("content-type");S.includes("application/json")?console.log("JSON 数据:",m=await b.json()):S.includes("text/")&&console.log("文本数据:",h=await w.text()),m=m||{},h=h||"",200===w.status&&(null===(u=m.data)||void 0===u?void 0:u.jobStatus)==="running"?d&&d():200!==w.status?d&&d():200===w.status&&h.includes("__LLM_RESPONSE__")?c&&c():d&&d();let k=e=>{i(e.replace(/\[\[([cC])itation/g,"[citation").replace(/[cC]itation:(\d+)]]/g,"citation:$1]").replace(/\[\[([cC]itation:\d+)]](?!])/g,"[$1]").replace(/\[[cC]itation:(\d+)]/g,"[citation]($1)"))};v(j,e=>{if(f=new Uint8Array([...f,...e]),(p=x.decode(f,{stream:!0})).includes(N)){let[e,t]=p.split(N);if(!g)try{l(JSON.parse(e))}catch(e){l([])}if(g=!0,t.includes(y)){let[e]=t.split(y);k(e)}else k(t)}},()=>{let[e,t]=p.split(y)})};var _=n(6519);let C=e=>{let{queryParams:t}=e,[n,r]=(0,a.useState)([]),[l,i]=(0,a.useState)(""),[o,c]=(0,a.useState)(null),d=async(e,n,s,a)=>{n?k(e,t.query,t.rid,t.search_type,n,(0,p.VQ)(),r,i,c,s,a):c(500)},u=(0,a.useRef)(!0);(0,a.useEffect)(()=>{if(console.log("result.tsx: ",t),""!=t.query&&u.current){console.log("[in]result.tsx: ",t);let e=new AbortController;return(async()=>{m(e,await S(t.query,t.rid,t.searchType,(0,p.VQ)()))})(),u.current=!1,()=>{e.abort()}}},[t]);let m=(e,t)=>{d(e,t,()=>{console.log("success!")},()=>{console.log("failed"),setTimeout(()=>{m(e,t)},5e3)})};return(0,s.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,s.jsx)(g,{markdown:l,sources:n}),(0,s.jsx)(b,{sources:n}),o&&(0,s.jsx)("div",{className:"absolute inset-4 flex items-center justify-center bg-white/40 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"p-4 bg-white shadow-2xl rounded text-blue-500 font-medium flex gap-4",children:[(0,s.jsx)(_.Z,{}),429===o?p.ZP.Err[429]:p.ZP.Err[500]]})})]})};var z=n(4981),E=n(3196),P=n(6463);let T=e=>{let{query:t}=e;return(0,P.useRouter)(),(0,s.jsxs)("div",{className:"items-center pb-4 flex  mb-6 border-b gap-4",children:[(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsxs)("button",{onClick:()=>{window.location.href=window.location.origin},type:"button",className:"text-blue-500 hover:bg-zinc-100 rounded flex gap-2 items-center bg-transparent px-2 py-1 text-xs font-semibold ",children:[(0,s.jsx)(E.Z,{size:24}),p.ZP.Title.return]})}),(0,s.jsx)("div",{className:"flex-1 text-lg sm:text-xl text-black text-ellipsis overflow-hidden whitespace-nowrap",title:t,children:t})]})};function I(){let e=(0,P.useSearchParams)(),[t,n]=(0,a.useState)({query:"",rid:"",searchType:""});return(0,a.useEffect)(()=>{let t=decodeURIComponent(e.get("q")||""),s=decodeURIComponent(e.get("rid")||""),a=decodeURIComponent(e.get("search_type")||"");return console.log("page.tsx: ",t,s,a),n({query:t,rid:s,searchType:a}),()=>{}},[]),(0,s.jsx)("div",{id:"searchresult",className:"absolute inset-0",children:(0,s.jsxs)("div",{className:"mx-auto max-w-3xl absolute inset-4 md:inset-8 bg-white",children:[(0,s.jsx)("div",{className:"h-20 pointer-events-none rounded-t-2xl w-full backdrop-filter absolute top-0 bg-gradient-to-t from-transparent to-white [mask-image:linear-gradient(to_bottom,white,transparent)]"}),(0,s.jsxs)("div",{className:"px-4 md:px-8 pt-6 pb-24 rounded-2xl h-full overflow-auto",children:[(0,s.jsx)(T,{query:t.query}),(0,s.jsx)(C,{queryParams:t},t.rid)]}),(0,s.jsx)("div",{className:"h-80 pointer-events-none w-full rounded-b-2xl backdrop-filter absolute bottom-0 bg-gradient-to-b from-transparent to-white [mask-image:linear-gradient(to_top,white,transparent)]"}),(0,s.jsx)("div",{className:"absolute z-10 flex items-center justify-center bottom-6 px-4 md:px-8 w-full",children:(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(z.o,{useContinueButton:!0})})})]})})}},2553:function(e,t,n){"use strict";n.d(t,{T:function(){return s}});let s=(e,t,n)=>"".concat("/search.html","?q=").concat(encodeURIComponent(e),"&search_type=").concat(n,"&rid=").concat(t)}},function(e){e.O(0,[60,153,971,23,744],function(){return e(e.s=7602)}),_N_E=e.O()}]);